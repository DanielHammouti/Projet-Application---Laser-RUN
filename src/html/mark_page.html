<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/styleguide.css" />
    <link rel="stylesheet" href="../css/style_mark.css" />
    <script src="../js/chronometer.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Récupérer les notes brutes
        const rawRunningGrade = parseFloat(localStorage.getItem('rawRunningGrade')) || 0;
        const rawShootingGrade = parseFloat(localStorage.getItem('rawShootingGrade')) || 0;
        
        // Récupérer les pourcentages de répartition
        const runningPercentage = parseFloat(localStorage.getItem('runningPercentage')) || 50;
        const shootingPercentage = 100 - runningPercentage;
        
        // Calculer la note finale sur 20
        const runningPoints = (rawRunningGrade * runningPercentage) / 100 * 2; // Convertir en note sur 20
        const shootingPoints = (rawShootingGrade * shootingPercentage) / 100 * 2; // Convertir en note sur 20
        const finalGrade = runningPoints + shootingPoints;
        
        localStorage.setItem('finalGrade', finalGrade);

        // Afficher les résultats
        const finalTime = parseInt(localStorage.getItem('finalTotalTime')) || 0;
        const minutes = Math.floor((finalTime / (1000 * 60)));
        const seconds = Math.floor((finalTime / 1000) % 60);
        const timeString = `${minutes.toString().padStart(2, '0')} : ${seconds.toString().padStart(2, '0')}`;
        
        // Récupérer le pourcentage de réussite au tir
        const shootingSuccessRate = parseFloat(localStorage.getItem('shootingSuccessRate')) || 0;
        
        // Mettre à jour l'affichage
        document.querySelector('.text-rectangle-noir').innerHTML = `Temps Total<br />${timeString}`;
        document.querySelector('.resultat-tir').textContent = `Tir Réussi : ${shootingSuccessRate.toFixed(1)}%`;
        document.querySelector('.resultat-note').innerHTML = `Vous avez obtenu <br> la note de <br> ${finalGrade.toFixed(1)}/20`;
        
        // Afficher les pourcentages utilisés et les notes détaillées dans le bloc dédié
        const details = `
            <div style="margin-top: 24px; text-align: center; font-size: 1.1em;">
                <p>Répartition des points :</p>
                <p>Course : ${runningPercentage}% - Tir : ${shootingPercentage}%</p>
                <p>Note course : ${rawRunningGrade}/10 (${runningPoints.toFixed(1)}/20)</p>
                <p>Note tir : ${rawShootingGrade}/10 (${shootingPoints.toFixed(1)}/20)</p>
            </div>
        `;
        document.querySelector('.resultat-details').innerHTML = details;
      });
    </script>
  </head>
  <body>
    <div class="home-page">
      <div class="div">
        <div class="rectangle-noir">
          <a href="settings_page.html" class="button_settings">
            <img class="parametres" src="../img/parametres.png" alt="Paramètres" />
          </a>
          <div class="text-rectangle-noir">Temps Total<br />00 : 00</div>
        </div>
        <div class="rectangle-vert">
          <div class="resultat-tir">Tir Réussi : XX%</div>
        </div>
        <div class="resultat-note">Vous avez obtenu <br> la note de XX/20</div>
        <div class="resultat-details"></div>
        
        <a href="statistic_page.html" class="statistique-wrapper">
          <img class="img" src="../img/statistique.png" alt="Statistiques" />
        </a>

        <a href="index.html" class="accueil-wrapper">
          <img class="img" src="../img/accueil.png" alt="Accueil" />
        </a>

        <a href="history_page.html" class="historique-wrapper">
          <img class="img" src="../img/historique.png" alt="Historique" />
        </a>
      </div>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/auth-check.js"></script>
  </body>
</html>