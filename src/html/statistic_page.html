<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/styleguide.css" />
    <link rel="stylesheet" href="../css/style_statistic.css" />
    <script src="../js/chronometer.js"></script>
  </head>
  <body>
    <div class="home-page">
      <div class="div">
        <div class="rectangle-noir">
            <a href="settings_page.html" class="button_settings">
                <img class="parametres" src="../img/parametres.png" alt="Paramètres" /></a>
          <div class="text-rectangle-noir">
            <div class="text-rectangle-noir">Statistiques</div>
          </div>
        </div>
        <div class="separation-line"></div>
        <div class="temps-moyen">
            <div class="text">Temps moyen au 100m</div>
        </div>
        <div class="separation-line"></div>
        <div class="text">Courbe</div>
        <canvas id="vitesseCourbe" width="600" height="300"></canvas>
    
    
        <a href="statistic_page.html" class="statistique-wrapper">
                <img class="img" src="../img/parametres.png" alt="Statistiques" /></a>
        
        <a href="statistic_page.html" class="button-wrapper">
        <div class="statistique-wrapper">
          <img class="img" src="../img/statistique.png" />
        </div>
        </a>

        <a href="index.html" class="button-wrapper">
        <div class="accueil-wrapper">
          <img class="img" src="../img/accueil.png" />
        </div>
        </a>

        <a href="history_page.html" class="button-wrapper">
        <div class="historique-wrapper">
          <img class="img" src="../img/historique.png" />
        </div>
        </a>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/auth-check.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/vitesse_chart.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Récupérer le temps total de la dernière course
      const finalTime = parseInt(localStorage.getItem('finalTotalTime')) || 0;
      // Calculer le temps moyen aux 100m
      let avg100m = '-- : --';
      if (finalTime > 0) {
        const avgSeconds = finalTime / 12 / 1000; // 1200m / 12 = 100m
        const min = Math.floor(avgSeconds / 60);
        const sec = Math.round(avgSeconds % 60);
        avg100m = `${min.toString().padStart(2, '0')} : ${sec.toString().padStart(2, '0')}`;
      }
      // Afficher dans la section prévue
      const avgDisplay = document.querySelector('.temps-moyen .text');
      if (avgDisplay) {
        avgDisplay.textContent = `Temps moyen au 100m : ${avg100m}`;
      }

      // Récupérer l'ordre des distances (par défaut [400,200,600])
      let distances = [400, 200, 600];
      try {
        const ordre = JSON.parse(localStorage.getItem('ordrePhases'));
        if (Array.isArray(ordre) && ordre.length === 3) {
          distances = ordre;
        }
      } catch (e) {}

      // Récupérer les temps de chaque phase (en ms)
      const phase1 = parseInt(localStorage.getItem('phase1Time')) || 0;
      const phase2 = parseInt(localStorage.getItem('phase2Time')) || 0;
      const phase3 = parseInt(localStorage.getItem('phase3Time')) || 0;

      // Préparer le tableau de données pour la courbe dans l'ordre choisi
      const tableau = [
        { distance: distances[0], temps: phase1 / 1000 },
        { distance: distances[1], temps: phase2 / 1000 },
        { distance: distances[2], temps: phase3 / 1000 }
      ];

      create_graph(tableau);
    });
    </script>
  </body>
</html>