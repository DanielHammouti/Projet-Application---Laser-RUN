<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/styleguide.css" />
    <link rel="stylesheet" href="../css/style_statistic.css" />
    <script src="../js/chronometer.js"></script>
  </head>
  <body>
    <div class="home-page">
      <div class="div">
        <div class="rectangle-noir">
            <a href="settings_page.html" class="button_settings">
                <img class="parametres" src="../img/parametres.png" alt="Paramètres" /></a>
          <div class="text-rectangle-noir">
            <div class="text-rectangle-noir">Statistiques</div>
          </div>
        </div>
        <div class="separation-line"></div>
        <div class="temps-moyen">
            <div class="text">Temps moyen au 100m</div>
            <div class="temps-phases">
                <div class="phase">Phase 1 : <span id="temps-phase1">-- : --</span></div>
                <div class="phase">Phase 2 : <span id="temps-phase2">-- : --</span></div>
                <div class="phase">Phase 3 : <span id="temps-phase3">-- : --</span></div>
                <div class="phase moyenne">Moyenne : <span id="temps-moyenne">-- : --</span></div>
            </div>
        </div>
        <div class="separation-line"></div>
        <div class="text">Courbe</div>
        <canvas id="vitesseCourbe" width="600" height="300"></canvas>
    
    
        <a href="statistic_page.html" class="statistique-wrapper">
                <img class="img" src="../img/parametres.png" alt="Statistiques" /></a>
        
        <a href="statistic_page.html" class="button-wrapper">
        <div class="statistique-wrapper">
          <img class="img" src="../img/statistique.png" />
        </div>
        </a>

        <a href="index.html" class="button-wrapper">
        <div class="accueil-wrapper">
          <img class="img" src="../img/accueil.png" />
        </div>
        </a>

        <a href="history_page.html" class="button-wrapper">
        <div class="historique-wrapper">
          <img class="img" src="../img/historique.png" />
        </div>
        </a>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/auth-check.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/stats.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Récupérer les temps de chaque phase (en ms)
      const phase1 = parseInt(localStorage.getItem('phase1Time')) || 0;
      const phase2 = parseInt(localStorage.getItem('phase2Time')) || 0;
      const phase3 = parseInt(localStorage.getItem('phase3Time')) || 0;

      console.log('Temps bruts du localStorage:', {
        phase1Time: localStorage.getItem('phase1Time'),
        phase2Time: localStorage.getItem('phase2Time'),
        phase3Time: localStorage.getItem('phase3Time')
      });
      
      console.log('Temps après parseInt:', {
        phase1,
        phase2,
        phase3
      });

      // Récupérer l'ordre des distances
      let distances = [400, 200, 600];
      try {
        const ordre = JSON.parse(localStorage.getItem('ordrePhases'));
        if (Array.isArray(ordre) && ordre.length === 3) {
          distances = ordre;
        }
      } catch (e) {}

      console.log('Distances:', distances);

      // Préparer le tableau de données pour la courbe et les moyennes
      const tableau = [
        { distance: distances[0], temps: phase1 / 1000 },
        { distance: distances[1], temps: phase2 / 1000 },
        { distance: distances[2], temps: phase3 / 1000 }
      ];

      console.log('Tableau préparé:', tableau);

      // Calculer et afficher tous les temps moyens
      const tempsMoyens = calculerTempsMoyen100m(tableau);
      document.getElementById('temps-phase1').textContent = tempsMoyens.phase1;
      document.getElementById('temps-phase2').textContent = tempsMoyens.phase2;
      document.getElementById('temps-phase3').textContent = tempsMoyens.phase3;
      document.getElementById('temps-moyenne').textContent = tempsMoyens.moyenne;

      create_graph(tableau);
    });
    </script>
  </body>
</html>